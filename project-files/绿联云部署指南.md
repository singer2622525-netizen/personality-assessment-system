# 部署到绿联云的步骤指南

## 📋 部署前准备

### 1. 检查项目文件
确保以下文件存在：
- `package.json` - 项目依赖配置
- `next.config.js` - Next.js配置
- `tailwind.config.js` - Tailwind CSS配置
- `tsconfig.json` - TypeScript配置
- `app/` - 应用代码目录
- `lib/` - 核心逻辑库

### 2. 创建生产环境配置

#### 修改 next.config.js
```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'standalone', // 用于Docker部署
  experimental: {
    // 移除已废弃的 appDir 配置
  },
  // 其他配置...
}

module.exports = nextConfig
```

#### 创建 Dockerfile
```dockerfile
FROM node:18-alpine AS base

# Install dependencies only when needed
FROM base AS deps
RUN apk add --no-cache libc6-compat
WORKDIR /app

COPY package.json package-lock.json* ./
RUN npm ci

# Rebuild the source code only when needed
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

RUN npm run build

# Production image, copy all the files and run next
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public

COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT 3000
ENV HOSTNAME "0.0.0.0"

CMD ["node", "server.js"]
```

#### 创建 docker-compose.yml
```yaml
version: '3.8'

services:
  personality-assessment:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
    restart: unless-stopped
    volumes:
      - ./data:/app/data  # 数据持久化
```

### 3. 创建部署脚本

#### 创建 deploy.sh
```bash
#!/bin/bash

echo "开始部署人格评测系统到绿联云..."

# 构建Docker镜像
echo "构建Docker镜像..."
docker build -t personality-assessment .

# 停止旧容器
echo "停止旧容器..."
docker-compose down

# 启动新容器
echo "启动新容器..."
docker-compose up -d

echo "部署完成！"
echo "访问地址: http://你的绿联云IP:3000"
```

## 🔧 绿联云部署步骤

### 方法1：通过Docker部署（推荐）

#### 步骤1：上传文件到绿联云
1. 将整个项目文件夹上传到绿联云
2. 确保包含所有必要文件

#### 步骤2：安装Docker
1. 在绿联云上安装Docker
2. 安装Docker Compose

#### 步骤3：构建和运行
```bash
# 进入项目目录
cd /path/to/your/project

# 构建镜像
docker build -t personality-assessment .

# 运行容器
docker-compose up -d
```

### 方法2：直接运行Node.js

#### 步骤1：安装Node.js
1. 在绿联云上安装Node.js 18+
2. 安装npm

#### 步骤2：安装依赖
```bash
npm install
```

#### 步骤3：构建项目
```bash
npm run build
```

#### 步骤4：启动服务
```bash
npm start
```

## 🌐 配置公网访问

### 1. 端口映射
- 在绿联云管理界面配置端口映射
- 将内网3000端口映射到公网端口

### 2. 域名配置（可选）
- 如果有域名，可以配置域名解析
- 使用HTTPS证书（推荐）

### 3. 防火墙设置
- 确保3000端口对外开放
- 配置安全规则

## 📊 监控和维护

### 1. 日志监控
```bash
# 查看容器日志
docker-compose logs -f

# 查看应用日志
tail -f /var/log/personality-assessment.log
```

### 2. 性能监控
- 监控CPU和内存使用情况
- 监控磁盘空间
- 监控网络流量

### 3. 数据备份
- 定期备份LocalStorage数据
- 备份配置文件
- 备份用户数据

## 🔒 安全配置

### 1. 访问控制
- 配置IP白名单（如果需要）
- 设置访问频率限制
- 配置用户认证

### 2. 数据加密
- 使用HTTPS传输
- 加密敏感数据
- 定期更新安全补丁

## 📱 使用说明

### 访问地址
- **内网访问**：`http://绿联云内网IP:3000`
- **公网访问**：`http://绿联云公网IP:3000`
- **域名访问**：`https://yourdomain.com`（如果配置了域名）

### 用户使用
1. 面试者访问链接填写评测
2. 管理员登录查看结果
3. 支持手机端和电脑端访问

## 🆘 故障排除

### 常见问题
1. **无法访问**：检查端口映射和防火墙
2. **服务停止**：检查容器状态和日志
3. **性能问题**：检查资源使用情况
4. **数据丢失**：检查数据持久化配置

### 联系支持
- 绿联云技术支持
- 项目开发者支持

---

*部署完成后，你就可以24小时不间断地为同事和面试者提供评测服务了！*
